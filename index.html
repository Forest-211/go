<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@varlet/ui/umd/varlet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <div id="app">
        {{ message }}
        <var-button type="primary" @click="handleCreatePost">create post</var-button>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue
        const token = ref('');

        const baseUrl = `http://localhost:8080`;
        const request = axios.create({
            baseURL: baseUrl,
        })
        createApp({
            setup () {
                const message = ref('Hello axios!')
                const handleLogin = async () => {
                    const result = await request.post('/login', {
                        username: 'changlin9',
                        password: '123456'
                    })
                    if (result.status == 200) {
                        token.value = result.data.token;
                    }
                    console.log('result', result)
                }

                const handleCreatePost = async () => {
                    console.log('create post')
                    // const result = await request(
                    //     {
                    //         method: 'POST',
                    //         url: '/v1/posts',
                    //         data: {
                    //             title: 'this is a create post',
                    //             content: 'add a new post'
                    //         },
                    //         headers: {
                    //             'Authorization': `Bearer ${token.value}`,
                    //             'Content-Type': 'application/json',
                    //         },
                    //         withCredentials: true,
                    //     })

                    const result = await request.post('/v1/posts', { title: 'this is a create post', content: 'create a new post' }, { headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token.value}` } })
                    console.log('result:', result)
                }

                onMounted(handleLogin)
                return {
                    message,
                    handleCreatePost
                }
            }
        }).use(Varlet).mount('#app')
    </script>
</body>

</html>